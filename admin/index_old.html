<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración de Pagos - VO2Max</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto py-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Administración de Pagos</h1>

        <!-- Tabla de Preinscripciones -->
        <div class="bg-white shadow-md rounded-lg overflow-hidden">
            <table class="min-w-full table-auto">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-4 py-2 text-left text-gray-600">Código</th>
                        <th class="px-4 py-2 text-left text-gray-600">Nombre</th>
                        <th class="px-4 py-2 text-left text-gray-600">Correo</th>
                        <th class="px-4 py-2 text-left text-gray-600">Estado</th>
                        <th class="px-4 py-2 text-left text-gray-600">Acciones</th>
                    </tr>
                </thead>
                <tbody id="preinscriptions-table" class="divide-y divide-gray-200">
                    <!-- Las filas se generarán dinámicamente con JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Verificar autenticación del administrador
        document.addEventListener('DOMContentLoaded', async () => {
            const response = await fetch('/api/check_auth.php');
            const result = await response.json();

            if (!result.authenticated) {
                window.location.href = '/admin/login.html';
            }
        });

        // Obtener preinscripciones desde el backend
        async function fetchPreinscriptions() {
            const response = await fetch('/api/get_preinscriptions.php');
            const data = await response.json();

            const table = document.getElementById('preinscriptions-table');
            table.innerHTML = '';

            data.forEach(pre => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2">${pre.codigo_preinscripcion}</td>
                    <td class="px-4 py-2">${pre.nombre} ${pre.apellido}</td>
                    <td class="px-4 py-2">${pre.correo}</td>
                    <td class="px-4 py-2">${pre.estado_pago}</td>
                    <td class="px-4 py-2">
                        <button class="bg-green-500 text-white px-4 py-2 rounded" onclick="validatePayment(${pre.id}, 'pagado')">Validar</button>
                        <button class="bg-red-500 text-white px-4 py-2 rounded" onclick="validatePayment(${pre.id}, 'rechazado')">Rechazar</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Validar o rechazar pago
        async function validatePayment(id, status) {
            const response = await fetch('/api/validar_pago.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, status })
            });

            const result = await response.json();
            alert(result.message);
            fetchPreinscriptions();
        }

        // Cargar preinscripciones al cargar la página
        document.addEventListener('DOMContentLoaded', fetchPreinscriptions);
    </script>
</body>
</html>