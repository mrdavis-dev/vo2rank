<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validaci√≥n de Pago - VO2Max Running</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-2xl w-full bg-white shadow-2xl rounded-xl overflow-hidden">
        
        <!-- Encabezado -->
        <div class="bg-gradient-to-r from-blue-500 to-green-500 text-white p-8 text-center">
            <img src="img/logovo2max.png" alt="Logo VO2Max" class="h-16 mx-auto mb-4 object-contain" style="filter: brightness(0) invert(1);">
            <h1 class="text-3xl font-bold mb-2">Subir Comprobante de Pago</h1>
            <p class="text-lg">Completa tu registro subiendo tu comprobante</p>
        </div>

        <div class="p-8">
            <!-- Informaci√≥n del Registro -->
            <div id="registro-info" class="bg-blue-50 border border-blue-300 rounded-lg p-6 mb-6">
                <p class="text-gray-700"><span class="font-semibold">C√≥digo de Registro:</span> <span id="codigo-display" class="text-blue-600 font-mono">Cargando...</span></p>
                <p class="text-gray-700"><span class="font-semibold">Correo:</span> <span id="correo-display">Cargando...</span></p>
                <p class="text-gray-700"><span class="font-semibold">Nombre:</span> <span id="nombre-display">Cargando...</span></p>
                <p class="text-gray-700"><span class="font-semibold">Estado:</span> <span id="estado-display" class="font-semibold text-yellow-600">Pendiente</span></p>
            </div>

            <!-- Mensaje de Inscripciones Cerradas -->
            <div class="bg-red-50 border border-red-300 rounded-lg p-6 mb-6">
                <h3 class="font-semibold text-red-800 mb-2"><i class="fas fa-lock"></i> Inscripciones Cerradas</h3>
                <p class="text-red-700">Las inscripciones para VO2Max Running han sido cerradas. No se aceptar√°n nuevos comprobantes de pago en este momento.</p>
            </div>

            <!-- Formulario de Subida -->
            <!-- <form id="comprobante-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-upload"></i> Selecciona tu Comprobante
                    </label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition"
                         id="drop-zone">
                        <input type="file" id="comprobante-input" name="comprobante" accept="image/*,.pdf" required class="hidden">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600">Arrastra tu comprobante aqu√≠ o <span class="text-blue-500 font-semibold">haz clic</span></p>
                        <p class="text-sm text-gray-500 mt-2">Formatos permitidos: PNG, JPG, JPEG, PDF (M√°x. 10MB)</p>
                        <p id="filename-display" class="text-green-600 font-semibold mt-4 hidden"></p>
                    </div>
                </div>

                <div class="bg-green-50 border border-green-300 rounded-lg p-6">
                    <h3 class="font-semibold text-green-800 mb-3">Recuerda los M√©todos de Pago:</h3>
                    <div class="space-y-3">
                        <div>
                            <p class="font-semibold text-gray-700">üì± Yappy:</p>
                            <p class="text-gray-600">+507 6974-8190</p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-700">üè¶ Transferencia Banistmo:</p>
                            <p class="text-gray-600">
                                Cuenta de Ahorros<br>
                                Christopher Jurado<br>
                                0119978303
                            </p>
                        </div>
                    </div>
                </div>

                <button type="submit"
                        class="w-full bg-green-500 text-white py-3 px-4 rounded-lg font-bold text-lg hover:bg-green-600 transition flex items-center justify-center">
                    <i class="fas fa-check mr-2"></i> Enviar Comprobante
                </button>
            </form>
            --> 

            <!-- Mensaje de Error -->
            <!-- <div id="error-message" class="mt-4 bg-red-50 border border-red-300 rounded-lg p-4 text-red-700 hidden"></div>

            <!-- Mensaje de √âxito -->
            <!-- <div id="success-message" class="mt-4 bg-green-50 border border-green-300 rounded-lg p-4 text-green-700 hidden">
                <h3 class="font-semibold mb-2"><i class="fas fa-check-circle"></i> ¬°Comprobante Enviado!</h3>
                <p>El administrador validar√° tu comprobante. Recibir√°s un correo con tu n√∫mero de dorsal en breve.</p>
                <a href="index.html" class="inline-block mt-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
                    Volver al Inicio
                </a>
            </div>
            --> 

        </div>
    </div>

    <script>
        /*
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000/api' 
            : `${window.location.origin}/api`;
        let selectedFile = null;

        // Obtener c√≥digo de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const codigo = urlParams.get('codigo');

        if (!codigo) {
            document.getElementById('error-message').textContent = 'C√≥digo de registro no v√°lido';
            document.getElementById('error-message').classList.remove('hidden');
            document.getElementById('comprobante-form').style.display = 'none';
        }

        // Cargar informaci√≥n del registro
        async function cargarRegistro() {
            try {
                const response = await fetch(`${API_URL}/registro/${codigo}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                document.getElementById('codigo-display').textContent = codigo;
                document.getElementById('correo-display').textContent = data.correo;
                document.getElementById('nombre-display').textContent = `${data.nombre} ${data.apellido}`;
                
                // Mostrar estado
                const estadoSpan = document.getElementById('estado-display');
                const form = document.getElementById('comprobante-form');
                const success = document.getElementById('success-message');
                
                if (data.estado === 'pagado') {
                    estadoSpan.textContent = 'Confirmado';
                    estadoSpan.className = 'font-semibold text-green-600';
                    form.style.display = 'none';
                    success.classList.remove('hidden');
                } else if (data.estado === 'rechazado') {
                    estadoSpan.textContent = 'Rechazado - Intenta nuevamente';
                    estadoSpan.className = 'font-semibold text-red-600';
                    // Permite subir nuevamente si fue rechazado
                    form.style.display = 'block';
                } else if (data.estado === 'pendiente_validacion' && data.comprobante_filename) {
                    // Ya tiene comprobante, mostrar que fue enviado
                    estadoSpan.textContent = 'Comprobante Enviado - Esperando validaci√≥n';
                    estadoSpan.className = 'font-semibold text-blue-600';
                    form.style.display = 'none';
                    success.innerHTML = '<p class="text-blue-600"><i class="fas fa-check-circle mr-2"></i>Tu comprobante ha sido recibido. El administrador lo validar√° pronto.</p>';
                    success.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('error-message').textContent = error.message;
                document.getElementById('error-message').classList.remove('hidden');
            }
        }

        // Drag and drop
        const dropZone = document.getElementById('drop-zone');
        const input = document.getElementById('comprobante-input');

        dropZone.addEventListener('click', () => input.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#3b82f6';
            dropZone.style.backgroundColor = '#eff6ff';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '#d1d5db';
            dropZone.style.backgroundColor = 'transparent';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#d1d5db';
            dropZone.style.backgroundColor = 'transparent';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                input.files = files;
                actualizarNombreArchivo();
            }
        });

        input.addEventListener('change', actualizarNombreArchivo);

        function actualizarNombreArchivo() {
            if (input.files.length > 0) {
                selectedFile = input.files[0];
                document.getElementById('filename-display').textContent = `‚úì ${selectedFile.name}`;
                document.getElementById('filename-display').classList.remove('hidden');
            }
        }

        // Enviar comprobante
        document.getElementById('comprobante-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!selectedFile) {
                document.getElementById('error-message').textContent = 'Por favor selecciona un archivo';
                document.getElementById('error-message').classList.remove('hidden');
                return;
            }

            // Obtener bot√≥n de submit y deshabilitarlo
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';

            const formData = new FormData();
            formData.append('codigo', codigo);
            formData.append('comprobante', selectedFile);

            try {
                const response = await fetch(`${API_URL}/subir-comprobante`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('comprobante-form').style.display = 'none';
                    document.getElementById('success-message').classList.remove('hidden');
                    // No re-habilitar bot√≥n porque el formulario ya est√° oculto
                } else {
                    document.getElementById('error-message').textContent = data.error;
                    document.getElementById('error-message').classList.remove('hidden');
                    // Re-habilitar bot√≥n en caso de error
                    submitButton.disabled = false;
                    submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    submitButton.innerHTML = originalButtonText;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('error-message').textContent = 'Error al enviar el comprobante';
                document.getElementById('error-message').classList.remove('hidden');
                // Re-habilitar bot√≥n en caso de error
                submitButton.disabled = false;
                submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                submitButton.innerHTML = originalButtonText;
            }
        });

        // Cargar registro al iniciar
        cargarRegistro();
        */
    </script>
</body>
</html>